-- Copyright (c) 2022, Oracle and/or its affiliates.
-- Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl/

\sql
SET GLOBAL local_infile = 1;
DROP DATABASE IF EXISTS heatwaveml_bench;
CREATE DATABASE heatwaveml_bench;
USE heatwaveml_bench;

CREATE TABLE fashion_mnist_train ( label INT, pixel1 INT, pixel2 INT, pixel3 INT, pixel4 INT, pixel5 INT, pixel6 INT, pixel7 INT, pixel8 INT, pixel9 INT, pixel10 INT, pixel11 INT, pixel12 INT, pixel13 INT, pixel14 INT, pixel15 INT, pixel16 INT, pixel17 INT, pixel18 INT, pixel19 INT, pixel20 INT, pixel21 INT, pixel22 INT, pixel23 INT, pixel24 INT, pixel25 INT, pixel26 INT, pixel27 INT, pixel28 INT, pixel29 INT, pixel30 INT, pixel31 INT, pixel32 INT, pixel33 INT, pixel34 INT, pixel35 INT, pixel36 INT, pixel37 INT, pixel38 INT, pixel39 INT, pixel40 INT, pixel41 INT, pixel42 INT, pixel43 INT, pixel44 INT, pixel45 INT, pixel46 INT, pixel47 INT, pixel48 INT, pixel49 INT, pixel50 INT, pixel51 INT, pixel52 INT, pixel53 INT, pixel54 INT, pixel55 INT, pixel56 INT, pixel57 INT, pixel58 INT, pixel59 INT, pixel60 INT, pixel61 INT, pixel62 INT, pixel63 INT, pixel64 INT, pixel65 INT, pixel66 INT, pixel67 INT, pixel68 INT, pixel69 INT, pixel70 INT, pixel71 INT, pixel72 INT, pixel73 INT, pixel74 INT, pixel75 INT, pixel76 INT, pixel77 INT, pixel78 INT, pixel79 INT, pixel80 INT, pixel81 INT, pixel82 INT, pixel83 INT, pixel84 INT, pixel85 INT, pixel86 INT, pixel87 INT, pixel88 INT, pixel89 INT, pixel90 INT, pixel91 INT, pixel92 INT, pixel93 INT, pixel94 INT, pixel95 INT, pixel96 INT, pixel97 INT, pixel98 INT, pixel99 INT, pixel100 INT, pixel101 INT, pixel102 INT, pixel103 INT, pixel104 INT, pixel105 INT, pixel106 INT, pixel107 INT, pixel108 INT, pixel109 INT, pixel110 INT, pixel111 INT, pixel112 INT, pixel113 INT, pixel114 INT, pixel115 INT, pixel116 INT, pixel117 INT, pixel118 INT, pixel119 INT, pixel120 INT, pixel121 INT, pixel122 INT, pixel123 INT, pixel124 INT, pixel125 INT, pixel126 INT, pixel127 INT, pixel128 INT, pixel129 INT, pixel130 INT, pixel131 INT, pixel132 INT, pixel133 INT, pixel134 INT, pixel135 INT, pixel136 INT, pixel137 INT, pixel138 INT, pixel139 INT, pixel140 INT, pixel141 INT, pixel142 INT, pixel143 INT, pixel144 INT, pixel145 INT, pixel146 INT, pixel147 INT, pixel148 INT, pixel149 INT, pixel150 INT, pixel151 INT, pixel152 INT, pixel153 INT, pixel154 INT, pixel155 INT, pixel156 INT, pixel157 INT, pixel158 INT, pixel159 INT, pixel160 INT, pixel161 INT, pixel162 INT, pixel163 INT, pixel164 INT, pixel165 INT, pixel166 INT, pixel167 INT, pixel168 INT, pixel169 INT, pixel170 INT, pixel171 INT, pixel172 INT, pixel173 INT, pixel174 INT, pixel175 INT, pixel176 INT, pixel177 INT, pixel178 INT, pixel179 INT, pixel180 INT, pixel181 INT, pixel182 INT, pixel183 INT, pixel184 INT, pixel185 INT, pixel186 INT, pixel187 INT, pixel188 INT, pixel189 INT, pixel190 INT, pixel191 INT, pixel192 INT, pixel193 INT, pixel194 INT, pixel195 INT, pixel196 INT, pixel197 INT, pixel198 INT, pixel199 INT, pixel200 INT, pixel201 INT, pixel202 INT, pixel203 INT, pixel204 INT, pixel205 INT, pixel206 INT, pixel207 INT, pixel208 INT, pixel209 INT, pixel210 INT, pixel211 INT, pixel212 INT, pixel213 INT, pixel214 INT, pixel215 INT, pixel216 INT, pixel217 INT, pixel218 INT, pixel219 INT, pixel220 INT, pixel221 INT, pixel222 INT, pixel223 INT, pixel224 INT, pixel225 INT, pixel226 INT, pixel227 INT, pixel228 INT, pixel229 INT, pixel230 INT, pixel231 INT, pixel232 INT, pixel233 INT, pixel234 INT, pixel235 INT, pixel236 INT, pixel237 INT, pixel238 INT, pixel239 INT, pixel240 INT, pixel241 INT, pixel242 INT, pixel243 INT, pixel244 INT, pixel245 INT, pixel246 INT, pixel247 INT, pixel248 INT, pixel249 INT, pixel250 INT, pixel251 INT, pixel252 INT, pixel253 INT, pixel254 INT, pixel255 INT, pixel256 INT, pixel257 INT, pixel258 INT, pixel259 INT, pixel260 INT, pixel261 INT, pixel262 INT, pixel263 INT, pixel264 INT, pixel265 INT, pixel266 INT, pixel267 INT, pixel268 INT, pixel269 INT, pixel270 INT, pixel271 INT, pixel272 INT, pixel273 INT, pixel274 INT, pixel275 INT, pixel276 INT, pixel277 INT, pixel278 INT, pixel279 INT, pixel280 INT, pixel281 INT, pixel282 INT, pixel283 INT, pixel284 INT, pixel285 INT, pixel286 INT, pixel287 INT, pixel288 INT, pixel289 INT, pixel290 INT, pixel291 INT, pixel292 INT, pixel293 INT, pixel294 INT, pixel295 INT, pixel296 INT, pixel297 INT, pixel298 INT, pixel299 INT, pixel300 INT, pixel301 INT, pixel302 INT, pixel303 INT, pixel304 INT, pixel305 INT, pixel306 INT, pixel307 INT, pixel308 INT, pixel309 INT, pixel310 INT, pixel311 INT, pixel312 INT, pixel313 INT, pixel314 INT, pixel315 INT, pixel316 INT, pixel317 INT, pixel318 INT, pixel319 INT, pixel320 INT, pixel321 INT, pixel322 INT, pixel323 INT, pixel324 INT, pixel325 INT, pixel326 INT, pixel327 INT, pixel328 INT, pixel329 INT, pixel330 INT, pixel331 INT, pixel332 INT, pixel333 INT, pixel334 INT, pixel335 INT, pixel336 INT, pixel337 INT, pixel338 INT, pixel339 INT, pixel340 INT, pixel341 INT, pixel342 INT, pixel343 INT, pixel344 INT, pixel345 INT, pixel346 INT, pixel347 INT, pixel348 INT, pixel349 INT, pixel350 INT, pixel351 INT, pixel352 INT, pixel353 INT, pixel354 INT, pixel355 INT, pixel356 INT, pixel357 INT, pixel358 INT, pixel359 INT, pixel360 INT, pixel361 INT, pixel362 INT, pixel363 INT, pixel364 INT, pixel365 INT, pixel366 INT, pixel367 INT, pixel368 INT, pixel369 INT, pixel370 INT, pixel371 INT, pixel372 INT, pixel373 INT, pixel374 INT, pixel375 INT, pixel376 INT, pixel377 INT, pixel378 INT, pixel379 INT, pixel380 INT, pixel381 INT, pixel382 INT, pixel383 INT, pixel384 INT, pixel385 INT, pixel386 INT, pixel387 INT, pixel388 INT, pixel389 INT, pixel390 INT, pixel391 INT, pixel392 INT, pixel393 INT, pixel394 INT, pixel395 INT, pixel396 INT, pixel397 INT, pixel398 INT, pixel399 INT, pixel400 INT, pixel401 INT, pixel402 INT, pixel403 INT, pixel404 INT, pixel405 INT, pixel406 INT, pixel407 INT, pixel408 INT, pixel409 INT, pixel410 INT, pixel411 INT, pixel412 INT, pixel413 INT, pixel414 INT, pixel415 INT, pixel416 INT, pixel417 INT, pixel418 INT, pixel419 INT, pixel420 INT, pixel421 INT, pixel422 INT, pixel423 INT, pixel424 INT, pixel425 INT, pixel426 INT, pixel427 INT, pixel428 INT, pixel429 INT, pixel430 INT, pixel431 INT, pixel432 INT, pixel433 INT, pixel434 INT, pixel435 INT, pixel436 INT, pixel437 INT, pixel438 INT, pixel439 INT, pixel440 INT, pixel441 INT, pixel442 INT, pixel443 INT, pixel444 INT, pixel445 INT, pixel446 INT, pixel447 INT, pixel448 INT, pixel449 INT, pixel450 INT, pixel451 INT, pixel452 INT, pixel453 INT, pixel454 INT, pixel455 INT, pixel456 INT, pixel457 INT, pixel458 INT, pixel459 INT, pixel460 INT, pixel461 INT, pixel462 INT, pixel463 INT, pixel464 INT, pixel465 INT, pixel466 INT, pixel467 INT, pixel468 INT, pixel469 INT, pixel470 INT, pixel471 INT, pixel472 INT, pixel473 INT, pixel474 INT, pixel475 INT, pixel476 INT, pixel477 INT, pixel478 INT, pixel479 INT, pixel480 INT, pixel481 INT, pixel482 INT, pixel483 INT, pixel484 INT, pixel485 INT, pixel486 INT, pixel487 INT, pixel488 INT, pixel489 INT, pixel490 INT, pixel491 INT, pixel492 INT, pixel493 INT, pixel494 INT, pixel495 INT, pixel496 INT, pixel497 INT, pixel498 INT, pixel499 INT, pixel500 INT, pixel501 INT, pixel502 INT, pixel503 INT, pixel504 INT, pixel505 INT, pixel506 INT, pixel507 INT, pixel508 INT, pixel509 INT, pixel510 INT, pixel511 INT, pixel512 INT, pixel513 INT, pixel514 INT, pixel515 INT, pixel516 INT, pixel517 INT, pixel518 INT, pixel519 INT, pixel520 INT, pixel521 INT, pixel522 INT, pixel523 INT, pixel524 INT, pixel525 INT, pixel526 INT, pixel527 INT, pixel528 INT, pixel529 INT, pixel530 INT, pixel531 INT, pixel532 INT, pixel533 INT, pixel534 INT, pixel535 INT, pixel536 INT, pixel537 INT, pixel538 INT, pixel539 INT, pixel540 INT, pixel541 INT, pixel542 INT, pixel543 INT, pixel544 INT, pixel545 INT, pixel546 INT, pixel547 INT, pixel548 INT, pixel549 INT, pixel550 INT, pixel551 INT, pixel552 INT, pixel553 INT, pixel554 INT, pixel555 INT, pixel556 INT, pixel557 INT, pixel558 INT, pixel559 INT, pixel560 INT, pixel561 INT, pixel562 INT, pixel563 INT, pixel564 INT, pixel565 INT, pixel566 INT, pixel567 INT, pixel568 INT, pixel569 INT, pixel570 INT, pixel571 INT, pixel572 INT, pixel573 INT, pixel574 INT, pixel575 INT, pixel576 INT, pixel577 INT, pixel578 INT, pixel579 INT, pixel580 INT, pixel581 INT, pixel582 INT, pixel583 INT, pixel584 INT, pixel585 INT, pixel586 INT, pixel587 INT, pixel588 INT, pixel589 INT, pixel590 INT, pixel591 INT, pixel592 INT, pixel593 INT, pixel594 INT, pixel595 INT, pixel596 INT, pixel597 INT, pixel598 INT, pixel599 INT, pixel600 INT, pixel601 INT, pixel602 INT, pixel603 INT, pixel604 INT, pixel605 INT, pixel606 INT, pixel607 INT, pixel608 INT, pixel609 INT, pixel610 INT, pixel611 INT, pixel612 INT, pixel613 INT, pixel614 INT, pixel615 INT, pixel616 INT, pixel617 INT, pixel618 INT, pixel619 INT, pixel620 INT, pixel621 INT, pixel622 INT, pixel623 INT, pixel624 INT, pixel625 INT, pixel626 INT, pixel627 INT, pixel628 INT, pixel629 INT, pixel630 INT, pixel631 INT, pixel632 INT, pixel633 INT, pixel634 INT, pixel635 INT, pixel636 INT, pixel637 INT, pixel638 INT, pixel639 INT, pixel640 INT, pixel641 INT, pixel642 INT, pixel643 INT, pixel644 INT, pixel645 INT, pixel646 INT, pixel647 INT, pixel648 INT, pixel649 INT, pixel650 INT, pixel651 INT, pixel652 INT, pixel653 INT, pixel654 INT, pixel655 INT, pixel656 INT, pixel657 INT, pixel658 INT, pixel659 INT, pixel660 INT, pixel661 INT, pixel662 INT, pixel663 INT, pixel664 INT, pixel665 INT, pixel666 INT, pixel667 INT, pixel668 INT, pixel669 INT, pixel670 INT, pixel671 INT, pixel672 INT, pixel673 INT, pixel674 INT, pixel675 INT, pixel676 INT, pixel677 INT, pixel678 INT, pixel679 INT, pixel680 INT, pixel681 INT, pixel682 INT, pixel683 INT, pixel684 INT, pixel685 INT, pixel686 INT, pixel687 INT, pixel688 INT, pixel689 INT, pixel690 INT, pixel691 INT, pixel692 INT, pixel693 INT, pixel694 INT, pixel695 INT, pixel696 INT, pixel697 INT, pixel698 INT, pixel699 INT, pixel700 INT, pixel701 INT, pixel702 INT, pixel703 INT, pixel704 INT, pixel705 INT, pixel706 INT, pixel707 INT, pixel708 INT, pixel709 INT, pixel710 INT, pixel711 INT, pixel712 INT, pixel713 INT, pixel714 INT, pixel715 INT, pixel716 INT, pixel717 INT, pixel718 INT, pixel719 INT, pixel720 INT, pixel721 INT, pixel722 INT, pixel723 INT, pixel724 INT, pixel725 INT, pixel726 INT, pixel727 INT, pixel728 INT, pixel729 INT, pixel730 INT, pixel731 INT, pixel732 INT, pixel733 INT, pixel734 INT, pixel735 INT, pixel736 INT, pixel737 INT, pixel738 INT, pixel739 INT, pixel740 INT, pixel741 INT, pixel742 INT, pixel743 INT, pixel744 INT, pixel745 INT, pixel746 INT, pixel747 INT, pixel748 INT, pixel749 INT, pixel750 INT, pixel751 INT, pixel752 INT, pixel753 INT, pixel754 INT, pixel755 INT, pixel756 INT, pixel757 INT, pixel758 INT, pixel759 INT, pixel760 INT, pixel761 INT, pixel762 INT, pixel763 INT, pixel764 INT, pixel765 INT, pixel766 INT, pixel767 INT, pixel768 INT, pixel769 INT, pixel770 INT, pixel771 INT, pixel772 INT, pixel773 INT, pixel774 INT, pixel775 INT, pixel776 INT, pixel777 INT, pixel778 INT, pixel779 INT, pixel780 INT, pixel781 INT, pixel782 INT, pixel783 INT, pixel784 INT);
CREATE TABLE fashion_mnist_test LIKE fashion_mnist_train;

\js
util.importTable("fashion_mnist_train.csv",{table: "fashion_mnist_train", dialect: "csv-unix", skipRows:1})
util.importTable("fashion_mnist_test.csv",{table: "fashion_mnist_test", dialect: "csv-unix", skipRows:1})

\sql
-- Train the model
CALL sys.ML_TRAIN('heatwaveml_bench.fashion_mnist_train', 'label', JSON_OBJECT('task', 'classification'), @model_fashion_mnist);
-- Load the model into HeatWave
CALL sys.ML_MODEL_LOAD(@model_fashion_mnist, NULL);
-- Score the model on the test data
CALL sys.ML_SCORE('heatwaveml_bench.fashion_mnist_test', 'label', @model_fashion_mnist, 'balanced_accuracy', @score_fashion_mnist, null);
-- Print the score
SELECT @score_fashion_mnist;
